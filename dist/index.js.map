{"version":3,"sources":["../src/index.ts"],"sourcesContent":["interface StorageValue<T> {\r\n  value: T;\r\n  expiry: number | null;\r\n}\r\n\r\nexport class SafeVault<Schema extends Record<string, any>> {\r\n  private storage: Storage;\r\n\r\n  constructor(storage: Storage = localStorage) {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"SafeVault can only be used in browser environments\");\r\n    }\r\n    this.storage = storage;\r\n  }\r\n\r\n  /**\r\n   * Set a value with optional TTL (in milliseconds)\r\n   */\r\n  set<K extends keyof Schema>(\r\n    key: K,\r\n    value: Schema[K],\r\n    ttl?: number\r\n  ): void {\r\n    const expiry = typeof ttl === \"number\" ? Date.now() + ttl : null;\r\n\r\n    const data: StorageValue<Schema[K]> = {\r\n      value,\r\n      expiry,\r\n    };\r\n\r\n    this.storage.setItem(key as string, JSON.stringify(data));\r\n  }\r\n\r\n  /**\r\n   * Get a value. Returns null if expired or not found.\r\n   */\r\n  get<K extends keyof Schema>(key: K): Schema[K] | null {\r\n    const item = this.storage.getItem(key as string);\r\n    if (!item) return null;\r\n\r\n    try {\r\n      const data: StorageValue<Schema[K]> = JSON.parse(item);\r\n\r\n      if (data.expiry !== null && Date.now() > data.expiry) {\r\n        this.storage.removeItem(key as string);\r\n        return null;\r\n      }\r\n\r\n      return data.value;\r\n    } catch {\r\n      // corrupted JSON\r\n      this.storage.removeItem(key as string);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a single key\r\n   */\r\n  remove<K extends keyof Schema>(key: K): void {\r\n    this.storage.removeItem(key as string);\r\n  }\r\n\r\n  /**\r\n   * Clear all storage\r\n   */\r\n  clear(): void {\r\n    this.storage.clear();\r\n  }\r\n}\r\n"],"mappings":";AAKO,IAAM,YAAN,MAAoD;AAAA,EACjD;AAAA,EAER,YAAY,UAAmB,cAAc;AAC3C,QAAI,OAAO,WAAW,aAAa;AACjC,YAAM,IAAI,MAAM,oDAAoD;AAAA,IACtE;AACA,SAAK,UAAU;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,IACE,KACA,OACA,KACM;AACN,UAAM,SAAS,OAAO,QAAQ,WAAW,KAAK,IAAI,IAAI,MAAM;AAE5D,UAAM,OAAgC;AAAA,MACpC;AAAA,MACA;AAAA,IACF;AAEA,SAAK,QAAQ,QAAQ,KAAe,KAAK,UAAU,IAAI,CAAC;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA,EAKA,IAA4B,KAA0B;AACpD,UAAM,OAAO,KAAK,QAAQ,QAAQ,GAAa;AAC/C,QAAI,CAAC,KAAM,QAAO;AAElB,QAAI;AACF,YAAM,OAAgC,KAAK,MAAM,IAAI;AAErD,UAAI,KAAK,WAAW,QAAQ,KAAK,IAAI,IAAI,KAAK,QAAQ;AACpD,aAAK,QAAQ,WAAW,GAAa;AACrC,eAAO;AAAA,MACT;AAEA,aAAO,KAAK;AAAA,IACd,QAAQ;AAEN,WAAK,QAAQ,WAAW,GAAa;AACrC,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAA+B,KAAc;AAC3C,SAAK,QAAQ,WAAW,GAAa;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,QAAc;AACZ,SAAK,QAAQ,MAAM;AAAA,EACrB;AACF;","names":[]}